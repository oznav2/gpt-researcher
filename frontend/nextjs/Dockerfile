FROM node:18.17.0-alpine as builder
WORKDIR /app
COPY ./package.json ./

ARG OPENAI_API_KEY
ARG TAVILY_API_KEY
ARG GOOGLE_API_KEY
ARG GOOGLE_CX_KEY
ARG BING_API_KEY
ARG SERPAPI_API_KEY
ARG SERPER_API_KEY
ARG LANGCHAIN_API_KEY
ARG SEARCHAPI_API_KEY
ARG ANTHROPIC_API_KEY
ARG NCBI_API_KEY
ARG EXA_API_KEY
ARG NEXT_PUBLIC_API_URL
ARG NEXT_PUBLIC_SITE_URL

ENV OPENAI_API_KEY=${OPENAI_API_KEY}
ENV TAVILY_API_KEY=${TAVILY_API_KEY}
ENV GOOGLE_API_KEY=${GOOGLE_API_KEY}
ENV GOOGLE_CX_KEY=${GOOGLE_CX_KEY}
ENV BING_API_KEY=${BING_API_KEY}
ENV SERPAPI_API_KEY=${SERPAPI_API_KEY}
ENV SERPER_API_KEY=${SERPER_API_KEY}
ENV LANGCHAIN_API_KEY=${LANGCHAIN_API_KEY}
ENV SEARCHAPI_API_KEY=${SEARCHAPI_API_KEY}
ENV ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
ENV NCBI_API_KEY=${NCBI_API_KEY}
ENV EXA_API_KEY=${EXA_API_KEY}
ENV NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL}
ENV NEXT_PUBLIC_SITE_URL=${NEXT_PUBLIC_SITE_URL}

RUN npm install --legacy-peer-deps
COPY . .
RUN npm run build

FROM nginx
EXPOSE 3000
COPY ./nginx/default.conf /etc/nginx/conf.d/default.conf
COPY --from=builder /app/build /usr/share/nginx/html
